<!DOCTYPE html>

<html>
    <head>
        <title>Klumpenpunkten</title>
        
        <link type="text/css" rel="stylesheet" href="http://www.x3dom.org/download/dev/x3dom.css">
    <script type="text/javascript" src="http://www.x3dom.org/download/dev/x3dom.js"></script>
   
    <style type="text/css">
        input {
            width: 100px;
            margin: 10px;
        }
          
      
    </style>
    </head>
    <body>
        <br></br>
        <center><h1>Klumpenpunkten</h1></center>

        <table>
  <tr>
      <td width=70%><x3d width="1024" height="1024">
			<scene>
				<!--Einstellen des Blickwinkels-->
				<Viewpoint DEF='pos20' fieldOfView='1.2' position="-1.4 10 10" orientation=" 0  0 1 0" ></Viewpoint>
                
<!--                <transform scale="10 0.01 15">
                    <shape>
                        <appearance>
                            <ImageTexture url='bottom.jpg'>
                                <TextureProperties generateMipMaps='true' magnificationFilter='linear' minificationFilter='linear'></TextureProperties>
                            </ImageTexture>
                        </appearance>
                        <box></box>
                        
                        
                    </shape>
                </transform>
                
                <transform id="leinwand">
                    
                    <transform id="stHinten" translation="0 3.5 -2.6">
                        <transform rotation="1 0 0 0.3926991">
                            <transform scale="0.2 3.9 0.2">
                                <shape>
                                    <appearance>
                                        <material diffuseColor="#A94700">

                                        </material>
                                    </appearance>
                                    <box></box>
                                   
                                </shape>                            
                            </transform>
                        </transform>
                    </transform>

                    <transform id="lwGestell" translation="0 3.2 0">
                        
                        <transform rotation="1 0 0 -0.2617994">
                            <transform id="stRechts" rotation="0 0 1 0.3490659">
                                <transform translation="1.5 0 0">
                                    <transform scale="0.2 4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>                            
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="stLinks" rotation="0 0 1 -0.3490659">
                                <transform translation="-1.5 0 0">
                                    <transform scale="0.2 4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="stVerbund" rotation="0 0 1 1.5707963">
                                <transform translation="1 0 0">
                                    <transform scale="0.2 1.4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="lwAblage" translation="0 -0.3 0.4">
                                <transform rotation="0 0 1 1.5707963">
                                    <transform scale="0.1 1.8 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="lw" rotation="0 0 0 1.5707963">
                                <transform translation="0 2.5 0.3">
                                    <transform scale="2 2.7 0.1">
                                        <shape onclick="getRayCollisionPoint(event)">
                                            <appearance>
                                                <ImageTexture url='lw.jpg'>
                                                    <TextureProperties generateMipMaps='true' magnificationFilter='linear' minificationFilter='linear'></TextureProperties>
                                                </ImageTexture>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>
                        </transform>
                        
                    </transform>
                    
                </transform>-->

        <inline url="Raum.x3d"></inline>
                
                <transform id="partikelSystem" scale="10 0.01 15">
                    <shape>
                        <appearance>
                            <Material diffuseColor="0 0 0.2"></Material>
                            <DepthMode readOnly="true"></DepthMode>
                        </appearance>
                        <ParticleSet id="ps" drawOrder ='backToFront' size="0.2 0.2 0.2, 1 1 1, 1 1 1, 1 1 1">
                            <Coordinate id="pos" point='0 500 0.5, 1 400 0, 4 12 0, -1 5 -2'></Coordinate>
                            <Color id="col" color='1 1 0, 1 0 0, 0 1 0, 0 0 1'></Color>
                        </ParticleSet>
                    </shape>
                </transform> 
                                
<!--                <transform id="ball"
                           translation="0 5.5 8">
                </transform>
                
                                
                
                <transform id="particels" 
                           translation="0 5.5 8">
                    
                </transform>-->
                                
                <timeSensor id="tS" loop="true" cycleInterval="2" enabled='true'>
                </timeSensor>
                <!--<orientationInterpolator id="oI" key="0.0 0.5 1.0" keyValue="0 1 0 0 , 0 1 0 3.14 , 0 1 0 6.28">
                </orientationInterpolator>
                <ROUTE fromNode='tS' fromField='fraction_changed' toNode='oI' toField='set_fraction'>
                </ROUTE>
                <ROUTE fromNode='oI' fromField='value_changed' toNode='particels' toField='set_rotation'>
                </ROUTE>-->
                                
                <positionInterpolator id="pI" key="0.0 0.5 1.0" keyValue="0 5.5 8 0.02 5.52 7.98 0 5.5 8">
                </positionInterpolator>
                <ROUTE fromNode='tS' fromField='fraction_changed' toNode='pI' toField='set_fraction'>
                </ROUTE>
                <ROUTE fromNode='pI' fromField='value_changed' toNode='particels' toField='set_translation'>
                </ROUTE>
                                
            </scene>
  </x3d></td>
        <td><table> <tr>
            <h2>Farbauswahl:</h2>
        <input id="k6" type="button" value="rot" onclick="rot();">
        <input id="k7" type="button" value="blau" onclick="blau();">
        <input id="k8" type="button" value="gelb" onclick="gelb();">
        <input id="k9" type="button" value="gruen" onclick="gruen();">
        <input id="k10" type="button" value="lila" onclick="lila();">
        <br><br></tr>
        <tr> <h2>Aktion:</h2>
        <br>
        <input id="k0" type="button" value="Partikel hinzufuegen" onClick="addParticle();">
        <input id="k1" type="button" value="neuer Ball" onClick="newBall();">
        <input id="k2" type="button" value="setze Farbe" onclick="sColor();">
        <input id="k3" type="button" value="Start" onClick="start();">
        <input id="k4" type="button" value="zuruecksetzen" onclick="Anhalten();">
        <input id="k5" type="button" value="animiert Partikel" onclick="moveParticles();">
        <input id="k6" type="button" value="wegklatschen" onclick="shotParticles();">
        <br><br></tr>
               <tr> <span id="meldung">Bitte erst Ziel auf der Leinwand setzen<span><br><br>
                <span id="meldung2">Sie klicken auf den Button "Partikel hinzufuegen"<span><br><br>   
                <span id="meldung3">Klicken Sie auf "animiert Partikel" <span><br><br>
                <br><br>
                <span id="meldung4">Den Start-Button bitte klicken  <span><br><br>
                <span id="meldung5">Waehlen Sie Ihre gewuenschte Farbe -> Syncen nicht vergessen!<span><br><br>
                <span id="meldung5">Lassen Sie Ihre Klumpen mit "wegklatschen" gegen/ durch die Wand fliegen<span><br><br>
                <span id="meldung5">Sie koennen einen "neuen Ball" erzeugen (Fuer weiteren Spielspass)<span><br><br>
                <span id="meldung5">Wenn gewuenscht koennen Sie den Zueruecksetz-Button klicken<span><br><br>
                <br><br>
                <span id="meldung6">Ihr Bachelor-Projekt-Team wuenscht Ihnen dabei viel Vergnuegen!<span>
   
    <script type="text/javascript">
//-------------------------------------------------------------------
//Globale Variablen:
		var ball = document.getElementById('ball');
                var particel = document.getElementById('partikelSystem');
		var bcolor;
		//falls der Aufprallpunkt nicht eingegeben wird
		var collisionPoint= new x3dom.fields.SFVec3f(0.0, 5.5, 8.0);
		var collision_z_Point;
                //var spherePosition= new x3dom.fields.SFVec3f(0.0, 5.5, 8.0);
		var spherePosition;
                document.getElementById('k0').disabled = true;
		document.getElementById('k1').disabled = true;
		document.getElementById('k2').disabled = true;
		document.getElementById('k4').disabled = true;
		//newBall();
		document.getElementById('k3').disabled = true;
		var AktionNR;
                var pAnzahl = 1000;
                var size = 3;
                var posX = 1;
                var schritt = true;
                var r;
                var g;
                var b;
                var flightDirections = new Array ([pAnzahl]);
 //-------------------------------------------------------------------
                function newBall(){
		//Start freigeben 
		document.getElementById('k3').disabled = false;
		//Flug stoppen
		isFlying=clearInterval(update);
            }
//--------------------------------------------------------------------
/*               particels();

		var id = "ballfarbe";
		//var color = "#808080";
		var sh = document.createElement('shape');
		var ap = document.createElement('appearance');
		var mat = document.createElement('material');
		var sphere = document.createElement('sphere');

		//sphere erstellen
		ball.appendChild(sh);
		sh.appendChild(ap);
		ap.appendChild(mat);
		mat.setAttribute('id', id);
		mat.setAttribute('diffuseColor', bcolor);
		sh.appendChild(sphere);


                //spherePosition=new x3dom.fields.SFVec3f(0.0, 5.5, 8.0);
                //Startposition Kugel neu setzen
                //particel.setAttribute("translation", spherePosition);
                //ball.setAttribute("translation", 0.0, 5.5, 8.0);
		spherePosition.x = 0;
		spherePosition.y = 5.5;
		spherePosition.z = 8.5
		}
*/      
//-------------------------------------------------------------------
//         function sColor()
//         {  
//            bcolor = document.getElementById('color').value;
//            
//            hexToRgb(bcolor);
//            
//            var colorDOMNode = document.getElementById("col");   
//            var colorObj = colorDOMNode.requestFieldRef("color");
//            for (var i = 0; i < pAnzahl; i++){
//                 colorObj[i] = new x3dom.fields.SFColor(r, g, b);
//            }
//            colorDOMNode.releaseFieldRef("color");
//         }
//         
//         function hexToRgb(hex) {
//            var color = hexToRgb(hex);
//
//            color.toString();
//
//            r = color.r;
//            console.log(color.r);
//            g = color.g;
//            console.log(color.g);
//            b = color.b;
//            console.log(color.b);
//}
         function rot(){
                       document.getElementById('k6').disabled = false;
                        document.getElementById('k7').disabled = true;
                        document.getElementById('k8').disabled = true;
                        document.getElementById('k9').disabled = true;
                        document.getElementById('k10').disabled = true;
                        
                            }
        function blau(){
                       document.getElementById('k7').disabled = false;
                       document.getElementById('k8').disabled = true;
                       document.getElementById('k9').disabled = true;
                       document.getElementById('k10').disabled = true;
                       document.getElementById('k6').disabled = true;
                       
                            }
        function gelb(){
                       document.getElementById('k8').disabled = false;
                       document.getElementById('k9').disabled = true;
                       document.getElementById('k10').disabled = true;
                       document.getElementById('k6').disabled = true;
                       document.getElementById('k7').disabled = true;
                            }
        function gruen(){
                       document.getElementById('k9').disabled = false;
                       document.getElementById('k10').disabled = true;
                       document.getElementById('k6').disabled = true;
                       document.getElementById('k7').disabled = true;
                       document.getElementById('k8').disabled = true;
                            }

        function lila(){
                       document.getElementById('k10').disabled = false;
                       document.getElementById('k6').disabled = true;
                       document.getElementById('k7').disabled = true;
                       document.getElementById('k8').disabled = true;
                       document.getElementById('k9').disabled = true;
                            }
//-------------------------------------------------------------------
	function start()
		{
		//Neuer Ball freigeben ->Start sperren 
                        document.getElementById('k0').disabled = true;
			document.getElementById('k1').disabled = false;
			document.getElementById('k3').disabled = true;
		//die updateseq.starten 
			isFlying=setInterval(update, 50);
			AktionNR = 1;

		}

//-------------------------------------------------------------------
         function Anhalten()
         {
		console.log("Anhalten");
		//Flug stoppen
		clearInterval(isFlying);

 		//sphere loeschen
		while(particel.hasChildNodes())
			particel.removeChild(particel.firstChild);
         }
         
//-------------------------------------------------------------------
         function getRayCollisionPoint(event)
         {
                 document.getElementById('k0').disabled = false;  
		 document.getElementById('k2').disabled = false;
		 document.getElementById('k3').disabled = false;
		 document.getElementById('k4').disabled = false;
          // cpa -> collisionPointArray
            var cpa=event.hitPnt;//haelt x,y,z Koordinaten als Array
			
		
             console.log(cpa);
             collisionPoint = new x3dom.fields.SFVec3f(cpa[0], cpa[1], cpa[2]);
             console.log(collisionPoint);
			 collision_z_Point = Math.abs(cpa[2]);
			 console.log(collision_z_Point);
          }
          
//-------------------------------------------------------------------
        function partikelPosition (index){
            var coordDOMNode  = document.getElementById("pos");
            var coordinateObj = coordDOMNode.requestFieldRef("point");
            
            console.log(coordinateObj[index]);
            return coordinateObj[index];
        }
//-------------------------------------------------------------------
          function computeFlightDirection()
          {
              var flightDirection = new x3dom.fields.SFVec3f(0.0, 0.0, 0.0);
              //Abspeichern aller Positionen
              for (var i = 0; i < pAnzahl; i++){
                  console.log("++++");
                  flightDirection = collisionPoint.subtract(partikelPosition(i));
                  flightDirections[i] = flightDirection;
                  console.log(flightDirection);
              }
              
              //flightDirection.normalize();
              //console.log(flightDirection);
              //return flightDirection;
              
          }
           
//-------------------------------------------------------------------
	function BallAktion1()
	{
            
            for (var i = 0; i <pAnzahl; i++){
                
                //Position des aktuellen Pertikel holen
                var position = partikelPosition(i);
                
                //flightDirection von Partikel holen
                console.log("---");
                var flightDirection = flightDirections[i];
                
                //Erste Aktion
                position.x += flightDirection.x * 0.1;
                position.y += flightDirection.y * 0.1;
                position.z += flightDirection.z * 0.1;
                
                 //neue Position abspeichern
                var coordDOMNode  = document.getElementById("pos");
                var coordinateObj = coordDOMNode.requestFieldRef("point");
		
                coordinateObj[i].x = position.x;
                coordinateObj[i].y = position.y;
                coordinateObj[i].z = position.z;
            }
	}

//-------------------------------------------------------------------
	function BallAktion2()
	{
	//Denk dir selbst eine Aktion aus:-)
	spherePosition.y = spherePosition.y + 0.2;
	console.log(spherePosition.y);
	var aktPosition = spherePosition.x + ' ' 
					 + spherePosition.y + ' ' 
					 + spherePosition.z;
	particel.setAttribute("translation", aktPosition);	  
	  
	}

//-------------------------------------------------------------------
		function update()
		//wird nur im Flug angesprochen
		{
			switch (AktionNR) {
			case 1:
					BallAktion1();
					//Weiterschaltbedingung
					if (spherePosition.z<= collision_z_Point){AktionNR = 2;}
					break;
			case 2:
					//BallAktion2();
					//Weiterschaltbedingung
					if (spherePosition.y>= 2){AktionNR = 3;}
					break;
			case 3:
					Anhalten();
					//colorizeLw();
					break;
			}
		 
		}
//-------------------------------------------------------------------
//         function colorizeLw()
//         {
//             var sP=document.getElementById("ball");
//			 
//					if (spherePosition.z<= collision_z_Point)
//					{
//
//					Anhalten();
//					}
//         }
//         
 //-------------------------------------------------------------------
 /*        function particels ()
        {
                
                var Anzahl = 500;
                //var i = 1;
                for (var i = 0; i<Anzahl; i++){
                    //neue Position, pro Partikel unterschiedlich
                    var px = 0 + (Math.random()/10);
                    var py = 0 + (Math.random()/10);
                    var pz = 0 + (Math.random()/10);
                    
                    var size = Math.random()/150;
                    
                    var partikel = document.createElement('transform');                                   
                    var id = "particels"+i;
                    //var color = "#808080";
                    var sh = document.createElement('shape');
                    var ap = document.createElement('appearance');
                    var mat = document.createElement('material');
                    var sphere = document.createElement('sphere');

                    //partikel erstellen
                    particel.appendChild(partikel);
                    partikel.appendChild(sh);
                    //GrÃ¶ÃŸe des Balls
                    partikel.setAttribute('scale', ''+size+' '+size+' '+size+'');
                    partikel.setAttribute('translation', ''+px+' '+py+' '+pz+'');
                    partikel.setAttribute('id', id);
                    sh.appendChild(ap);
                    ap.appendChild(mat);
                    //mat.setAttribute('id', id);
                    mat.setAttribute('diffuseColor', '#FF00BF');
                    sh.appendChild(sphere);  
                }                
        }
 */
//--------------------------------------------------------------------
        // Partikelsche
        
        function addParticle(){
            for(var i = 0; i < (pAnzahl-3); i++){
                var px = -0.35 + (Math.random()/2.5);   //Breite
                var py = 950 + (Math.random()*250); //Hoehe
                var pz = 0.5 + (Math.random()/5);   //Tiefe
                    
	    var coordDOMNode  = document.getElementById("pos");
            var coordinateObj = coordDOMNode.requestFieldRef("point");
		coordinateObj.length = ++size;
		coordinateObj[size] = new x3dom.fields.SFVec3f(px, py, pz);
		coordDOMNode.releaseFieldRef("point");
	
            var pSize = 0.08 + (Math.random()/5);
            
        var particleSetDOMNode = document.getElementById("ps");
        var sizeObj = particleSetDOMNode.requestFieldRef("size");
        sizeObj.length = coordinateObj.length;
        sizeObj[size] = new x3dom.fields.SFVec3f(pSize, pSize, pSize);
        particleSetDOMNode.releaseFieldRef("size");
        
        var colorDOMNode = document.getElementById("col");   
        var colorObj = colorDOMNode.requestFieldRef("color");
        colorObj.length = coordinateObj.length;  
        
        if(!document.getElementById('k7').disabled){
           colorObj[size] = new x3dom.fields.SFColor(0, 0, 238);
            }
            
            else if(!document.getElementById('k8').disabled){
           colorObj[size] = new x3dom.fields.SFColor(238, 238, 0);
            }
            
           else if(!document.getElementById('k9').disabled){
           colorObj[size] = new x3dom.fields.SFColor(0, 205, 0);
            }
            
           else if(!document.getElementById('k10').disabled){
           colorObj[size] = new x3dom.fields.SFColor(148, 0, 211);
            }
           else if(!document.getElementById('k6').disabled){
           colorObj[size] = new x3dom.fields.SFColor(1, 0, 0);
             }
            else{
        colorObj[size] = new x3dom.fields.SFColor(1, 1, 1);
    }
        
        colorDOMNode.releaseFieldRef("color");
    }
		
		console.log("ElementSize: " + size);
                //moveParticles();
	}
//---------------------------------------------------------------------

//    function moveParticles() 
//    {
//        lastTimestamp = performance.now();
//        
//        animateParticles(lastTimestamp);
//    }
//    
//    function animateParticles(timestamp) 
//    {
//        var vx, vy, vz;
//        var i;
//        
//        var dT = (timestamp - lastTimestamp) / 10000;
//        lastTimestamp = timestamp;
//        
//        // manipulate position values over time (fake velocity added to position)
//        var coordDOMNode  = document.getElementById("pos");
//        
//        var coordinateObj = coordDOMNode.requestFieldRef("point");
//        
//        for (i=0; i<pAnzahl; i++) {
//            vx = Math.random() * 1.2 - 1;   //Breite
//            vy = Math.random() * 120 - 100;   //Hoehe
//            vz = Math.random() * 1.2 - 1;   //Tiefe
//
//            if (schritt){
//               coordinateObj[i].x += vx * dT;
//               coordinateObj[i].y += vy * dT;
//               coordinateObj[i].z += vz * dT;
//            } else {
//               coordinateObj[i].x -= vx * dT;
//               coordinateObj[i].y -= vy * dT;
//               coordinateObj[i].z -= vz * dT;
//            }
//            
//        }
//        schritt = !schritt;
//        coordDOMNode.releaseFieldRef("point");
//        requestAnimationFrame(animateParticles);
//    }
//    

 //---------------------------------------------------------------------       
                 /* -> funktioniert nicht bzw. Buttons kann man net mehr anklicken!!
                 // Closure call
		(function mainLoop() {
        
			if(updateParts)
				moveParticle();
			
			// Renderloop 
			window.requestAnimationFrame(mainLoop);
		})();
                
                // Update
                var updateParts = false;
                
	// Script Einstiegspunkt
	function main(){
		console.log("Script now is active!");
     */
//---------------------------------------------------------------------                              

        
   </script> 
    
   </tr> </table></td></tr>
</table>
    
    </body>
</html>
