<!DOCTYPE html>

<html>
    <head>
        <title>Action Painting</title>
        
        <link type="text/css" rel="stylesheet" href="http://www.x3dom.org/download/dev/x3dom.css">
    <script type="text/javascript" src="http://www.x3dom.org/download/dev/x3dom.js"></script>
   
    <style type="text/css">
/*        input {
            width: 100px;
            margin: 10px;
        }
       */   
      
    </style>
    </head>
    <body>
        <center><h1>Action Painting</h1></center>

    
        
        <table>
  <tr>
      
      <td><x3d width="1024" height="512">
            <scene>
                
                <transform scale="10 0.01 10">
                    <shape>
                        <appearance>
                            <ImageTexture url='bottom.jpg'>
                                <TextureProperties generateMipMaps='true' magnificationFilter='linear' minificationFilter='linear'></TextureProperties>
                            </ImageTexture>
                        </appearance>
                        <box></box>
                    </shape>
                </transform>
                
                <transform id="leinwand">
                    
                    <transform id="stHinten" translation="0 3.5 -2.6">
                        <transform rotation="1 0 0 0.3926991">
                            <transform scale="0.2 3.9 0.2">
                                <shape>
                                    <appearance>
                                        <material diffuseColor="#A94700">

                                        </material>
                                    </appearance>
                                    <box></box>
                                   
                                </shape>                            
                            </transform>
                        </transform>
                    </transform>

                    <transform id="lwGestell" translation="0 3.2 0">
                        
                        <transform rotation="1 0 0 -0.2617994">
                            <transform id="stRechts" rotation="0 0 1 0.3490659">
                                <transform translation="1.5 0 0">
                                    <transform scale="0.2 4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>                            
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="stLinks" rotation="0 0 1 -0.3490659">
                                <transform translation="-1.5 0 0">
                                    <transform scale="0.2 4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="stVerbund" rotation="0 0 1 1.5707963">
                                <transform translation="1 0 0">
                                    <transform scale="0.2 1.4 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="lwAblage" translation="0 -0.3 0.4">
                                <transform rotation="0 0 1 1.5707963">
                                    <transform scale="0.1 1.8 0.2">
                                        <shape>
                                            <appearance>
                                                <material diffuseColor="#A94700">

                                                </material>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>

                            <transform id="lw" rotation="0 0 0 1.5707963">
                                <transform translation="0 2.5 0.3">
                                    <transform scale="2 2.7 0.1">
                                        <shape onclick="getRayCollisionPoint(event)">
                                            <appearance>
                                                <ImageTexture url='lw.jpg'>
                                                    <TextureProperties generateMipMaps='true' magnificationFilter='linear' minificationFilter='linear'></TextureProperties>
                                                </ImageTexture>
                                            </appearance>
                                            <box></box>
                                        </shape>
                                    </transform>
                                </transform>
                            </transform>
                        </transform>
                        
                    </transform>
                    
                </transform>
                
                <transform id="ball"
                           translation="0 5.5 8">
                </transform>
                
                
                
                <Shape id='Path'>
					<Appearance>
						<Material emissiveColor='0.3 0.3 0.8'/>
					</Appearance>
					<IndexedLineSet coordIndex='0 1 2 -1'>
						<Coordinate point='0 5.5 8 0 6 0 0 0 0'/>
					</IndexedLineSet>
				</Shape>
                
                
                
                <Shape id='Path2'>
					<Appearance>
						<Material emissiveColor='0.3 0.3 0.8'/>
					</Appearance>
					<IndexedLineSet coordIndex='0 1 2 -1'>
						<Coordinate point='0 5.5 8 0 4 0 0 0 0'/>
					</IndexedLineSet>
				</Shape>
                
                
                
                <Shape id='Path3'>
					<Appearance>
						<Material emissiveColor='0.3 0.3 0.8'/>
					</Appearance>
					<IndexedLineSet coordIndex='0 1 2 -1'>
						<Coordinate point='0 5.5 8 1.5 8 0 0 0 0'/>
					</IndexedLineSet>
				</Shape>
                
                                
            </scene>
        </x3d></td>
      
      
        <td> 
            <h1>Farbauswahl:</h1>
        <input id="color" type=color>

        <br><br>
        <h1>Action:</h1>
        <input type="button" value="new Ball" onClick="newBall();">
        <input type="button" value="set Color" onclick="sColor();">
        <input type="button" value="Start" onClick="start();">
        <input type="button" value="Reset" onclick="reset();">
   
    <script type="text/javascript">
            setInterval(update, 20);
             var collisionPoint;
             var spherePosition=new x3dom.fields.SFVec3f(0.0, 5.5, 8.0);
             var isFlying=0;
             
        function newBall(){
            var ball = document.getElementById('ball');
            var id = "ballfarbe";
            var color = "#FFFFFF";
            var sh = document.createElement('shape');
            var ap = document.createElement('appearance');
            var mat = document.createElement('material');
            var sphere = document.createElement('sphere');
         
            ball.appendChild(sh);
            sh.appendChild(ap);
            ap.appendChild(mat);
            mat.setAttribute('id', id);
            mat.setAttribute('diffuseColor', color);
            sh.appendChild(sphere);
            
            
            
            
        }
        
         function sColor()
         {  
            var ballfarbe = document.getElementById('ballfarbe');
             
            if(ballfarbe !== null){
               var bcolor = document.getElementById('color').value;
                
               ballfarbe.setAttribute("diffuseColor",bcolor);
            } else
               alert("Es existiert kein Ball");
         }
         
          function start()
         {
             isFlying=1;
         }
         
         function reset()
         {
             var ball = document.getElementById('ball');
             
             while(ball.hasChildNodes())
                 ball.removeChild(ball.firstChild);
         }
         
         function getRayCollisionPoint(event)
         {
             // cpa -> collisionPointArray
             var cpa=event.hitPnt;//hältx,y,z Koordinaten als array
             console.log(cpa);
             collisionPoint=new x3dom.fields.SFVec3f(cpa[0], cpa[1], cpa[2]);
             console.log(collisionPoint);
          }
          
          function computeFlightDirection()
          {
              var flightDirection= new x3dom.fields.SFVec3f(0.0, 0.0, 0.0);
              flightDirection= collisionPoint.subtract(spherePosition);
              console.log(flightDirection);
              flightDirection.normalize();
              console.log(flightDirection);
              return flightDirection;
              
          }
         /* 1. Punkt auf Leinwand ermitteln
          * 2. Flugbahn ist ausgerechnet
          * 3. Ausgerechnete Flugbahn(*Geschwindigkeit) auf Kugelposition aufaddieren
          */
          
          function shootBall()
          {
              var flightDirection=computeFlightDirection();
              /*
               * 1. Flugbahn zurückgegeben
               * 2. Position der Kugel holen
               * 3. Ausgerechnete Flugbahn(*Geschwindigkeit) auf Kugelposition aufaddieren
               */
              //spherePosition=spherePosition.add(flightDirection*0.5);
              spherePosition.x += flightDirection.x * 0.5;
              spherePosition.y += flightDirection.y * 0.5;
              spherePosition.z += flightDirection.z * 0.5;
              
              var ball=document.getElementById("ball");
              var finalePosition = spherePosition.x + ' ' 
                                 + spherePosition.y + ' ' 
                                 + spherePosition.z;
              ball.setAttribute("translation", finalePosition);
           
             //console.log(ball.getAttribute("transform"));
              
              
          }
          
          function update()
          {
              if (isFlying==1)
              {
                  shootBall();
                  colorizeLw();
              }
             
          }
         function colorizeLw()
         {
             //var sP=document.getElementById("ball");
             if (spherePosition.z<= 0.3)
             {
                 reset();
             }
         }
    </script> 
    </td>
    
  </tr>
</table>
        
        
        
       
     
       
    
    </body>
</html>
